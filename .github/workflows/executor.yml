name: ðŸ› ï¸ UNIVERSAL PHOENIX EXECUTOR

on:
  workflow_dispatch:
    inputs:
      task_payload:
        required: true
      run_id:
        required: false

jobs:
  execute:
    runs-on: ubuntu-latest
    steps:
      - name: 1.1 - Checkout
        uses: actions/checkout@v4

      - name: 1.2 - Decode
        run: |
          echo "${{ github.event.inputs.task_payload }}" | base64 -d > task.py
          if [ ! -s task.py ]; then exit 1; fi

      - name: 2.1 - Auto-Deps
        run: |
          IMPORTS=$(grep -E '^(import|from)' task.py | awk '{print $2}' | cut -d. -f1 | sort -u)
          for lib in $IMPORTS; do
            python3 -c "import $lib" 2>/dev/null || pip install --no-cache-dir $lib || true
          done

      - name: 3.1 - Run
        run: |
          python3 -u task.py 2>&1 | tee execution.log
          [ ${PIPESTATUS[0]} -eq 0 ] || exit 1

      - name: 4.1 - Summary
        if: always()
        run: |
          echo "### ðŸŒ Executor Report" >> $GITHUB_STEP_SUMMARY
          echo '```python' >> $GITHUB_STEP_SUMMARY
          [ -f execution.log ] && cat execution.log >> $GITHUB_STEP_SUMMARY || echo "No logs" >> $GITHUB_STEP_SUMMARY
          echo '```' >> $GITHUB_STEP_SUMMARY