name: ðŸ› ï¸ PHOENIX EXECUTOR

on:
  workflow_dispatch:
    inputs:
      task_payload:
        required: true
      run_id:
        required: false

jobs:
  execute:
    runs-on: ubuntu-latest
    steps:
      - name: 1.1 - Prepare Task
        run: |
          # Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„ÙƒÙˆØ¯ ÙˆØ­ÙØ¸Ù‡
          echo "${{ github.event.inputs.task_payload }}" > task.py
          
          # ÙØ­Øµ Ø¨Ø³ÙŠØ· Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ù…Ù„Ù Ù„ÙŠØ³ ÙØ§Ø±ØºØ§Ù‹ Ø£Ùˆ ØªØ§Ù„ÙØ§Ù‹
          if [ ! -s task.py ]; then
            echo "âŒ Task file is empty"
            exit 1
          fi

      - name: 2.1 - Run & Capture Logs
        run: |
          echo "--- EXECUTION START ---"
          # ØªØ´ØºÙŠÙ„ Ù…Ø¹ Ø¯Ù…Ø¬ Ø§Ù„Ø®Ø·Ø£ ÙˆØ§Ù„Ù…Ø®Ø±Ø¬Ø§Øª (Standard Out & Error)
          python3 -u task.py 2>&1 | tee execution_output.log
          
          # Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ù†Ø¬Ø§Ø­ ØªØ´ØºÙŠÙ„ Ø¨Ø§ÙŠØ«ÙˆÙ†
          if [ ${PIPESTATUS[0]} -ne 0 ]; then
            echo "âŒ Execution Failed with errors"
            exit 1
          fi
          echo "--- EXECUTION SUCCESS ---"

      - name: 3.1 - Generate Report
        if: always()
        run: |
          echo "### ðŸš€ Evolution Report" >> $GITHUB_STEP_SUMMARY
          echo "- **Commander ID:** ${{ github.event.inputs.run_id }}" >> $GITHUB_STEP_SUMMARY
          echo "#### Output Log:" >> $GITHUB_STEP_SUMMARY
          echo '```python' >> $GITHUB_STEP_SUMMARY
          cat execution_output.log >> $GITHUB_STEP_SUMMARY
          echo '```' >> $GITHUB_STEP_SUMMARY