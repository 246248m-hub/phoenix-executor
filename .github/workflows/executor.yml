name: ğŸ› ï¸ PHOENIX EXECUTOR

on:
  workflow_dispatch:
    inputs:
      task_payload:
        description: 'Python code to execute'
        required: true
      commander_repo:
        description: 'Source repository for logging'
        required: false
      run_id:
        description: 'ID of the commander run'
        required: false

jobs:
  execute_ai_logic:
    runs-on: ubuntu-latest
    steps:
      - name: 1.1 - Setup Environment
        uses: actions/checkout@v4

      - name: 1.2 - Install Common Dependencies
        run: |
          python -m pip install --upgrade pip
          # Ø¥Ø¶Ø§ÙØ© Ù…ÙƒØ§ØªØ¨ Ø´Ø§Ø¦Ø¹Ø© Ù‚Ø¯ ÙŠØ­ØªØ§Ø¬Ù‡Ø§ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ
          pip install requests numpy pandas 

      - name: 2.1 - Prepare Task File
        run: |
          # Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„ÙƒÙˆØ¯ ÙˆØ­ÙØ¸Ù‡ ÙÙŠ Ù…Ù„Ù
          echo "Preparing to run task from: ${{ github.event.inputs.commander_repo }}"
          cat << 'EOF_PYTHON' > task_execution.py
          ${{ github.event.inputs.task_payload }}
          EOF_PYTHON

      - name: 2.2 - Run Payload & Capture Logs
        id: run_step
        run: |
          echo "--- START OF AI EXECUTION ---"
          # ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯ ÙˆØ­ÙØ¸ Ø§Ù„Ù…Ø®Ø±Ø¬Ø§Øª ÙÙŠ Ù…Ù„Ù log
          python3 task_execution.py > execution.log 2>&1
          EXIT_CODE=$?
          echo "--- END OF AI EXECUTION ---"
          
          cat execution.log
          
          if [ $EXIT_CODE -ne 0 ]; then
            echo "Task failed with exit code $EXIT_CODE"
            exit $EXIT_CODE
          fi

      - name: 3.1 - Post Execution Summary
        if: always()
        run: |
          echo "### Execution Report ğŸš€" >> $GITHUB_STEP_SUMMARY
          echo "- **Commander Run ID:** ${{ github.event.inputs.run_id }}" >> $GITHUB_STEP_SUMMARY
          echo "- **Status:** ${{ job.status }}" >> $GITHUB_STEP_SUMMARY
          echo "#### Logs:" >> $GITHUB_STEP_SUMMARY
          echo '```' >> $GITHUB_STEP_SUMMARY
          cat execution.log | tail -n 20 >> $GITHUB_STEP_SUMMARY
          echo '```' >> $GITHUB_STEP_SUMMARY