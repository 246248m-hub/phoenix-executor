name: ðŸ› ï¸ PHOENIX EXECUTOR

on:
  workflow_dispatch:
    inputs:
      task_payload:
        description: 'Encoded Python Task'
        required: true

jobs:
  execute_task:
    runs-on: ubuntu-latest
    steps:
      - name: 1. Checkout
        uses: actions/checkout@v4

      - name: 2. Decode & Run
        run: |
          echo "${{ github.event.inputs.task_payload }}" | base64 -d > task.py
          python3 task.py > output.log 2> error_log.txt || echo "FAILED" > status.txt

      - name: 3. Sync to Commander
        env:
          GH_TOKEN: ${{ secrets.COMMANDER_PAT }}
          OWNER: ${{ github.repository_owner }}
        run: |
          # ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ø³ØªØ¨Ø¯Ø§Ù„ avatar-template Ø¨Ø§Ø³Ù… Ù…Ø³ØªÙˆØ¯Ø¹Ùƒ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ø¥Ø°Ø§ ØºÙŠØ±ØªÙ‡
          if [ -f error_log.txt ]; then
            SHA=$(gh api /repos/$OWNER/avatar-template/contents/error_log.txt --jq '.sha' || echo "")
            gh api --method PUT /repos/$OWNER/avatar-template/contents/error_log.txt \
              -f message="Update Error Log" \
              -f content="$(base64 -w 0 error_log.txt)" \
              -f sha="$SHA"
          fi
