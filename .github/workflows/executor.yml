name: ðŸ› ï¸ UNIVERSAL PHOENIX EXECUTOR

on:
  workflow_dispatch:
    inputs:
      task_payload:
        required: true
      run_id:
        required: false

jobs:
  execute:
    runs-on: ubuntu-latest
    steps:
      - name: 1.1 - Secure Checkout
        uses: actions/checkout@v4

      - name: 1.2 - Payload Decoding
        run: |
          # ÙÙƒ Ø§Ù„ØªØ´ÙÙŠØ± Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø£ØµÙ„ÙŠ
          echo "${{ github.event.inputs.task_payload }}" | base64 -d > task.py
          
          if [ ! -s task.py ]; then
            echo "âŒ CRITICAL: Payload is empty!"
            exit 1
          fi

      - name: 2.1 - Auto-Dependency Injection
        run: |
          echo "ðŸ” Scanning imports..."
          IMPORTS=$(grep -E '^(import|from)' task.py | awk '{print $2}' | cut -d. -f1 | sort -u)
          for lib in $IMPORTS; do
            if ! python3 -c "import $lib" 2>/dev/null; then
              echo "ðŸ“¦ Installing: $lib"
              pip install $lib || echo "âš ï¸ Skip $lib"
            fi
          done

      - name: 3.1 - Robust Execution
        run: |
          echo "ðŸš€ Executing..."
          # ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯ ÙˆØ§Ù„ØªÙ‚Ø§Ø· Ø§Ù„Ù†ØªØ§Ø¦Ø¬
          python3 -u task.py 2>&1 | tee execution_output.log
          if [ ${PIPESTATUS[0]} -ne 0 ]; then
            echo "âŒ Execution Failed"
            exit 1
          fi

      - name: 4.1 - Summary Report
        if: always()
        run: |
          echo "### ðŸŒ Universal Executor Report" >> $GITHUB_STEP_SUMMARY
          echo "- **Status:** ${{ job.status }}" >> $GITHUB_STEP_SUMMARY
          echo "- **Commander Run ID:** ${{ github.event.inputs.run_id }}" >> $GITHUB_STEP_SUMMARY
          echo "#### ðŸ“œ Execution Log:" >> $GITHUB_STEP_SUMMARY
          echo '```python' >> $GITHUB_STEP_SUMMARY
          cat execution_output.log >> $GITHUB_STEP_SUMMARY
          echo '```' >> $GITHUB_STEP_SUMMARY